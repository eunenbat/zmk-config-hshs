/*
 * Copyright (c) 2021-2022 The ZMK Contributors
 *
 * SPDX-License-Identifier: MIT
 */

#include <dt-bindings/zmk/matrix_transform.h>

/ {
    chosen {
        zmk,kscan = &kscan0;
    };

    default_transform: keymap_transform_0 {
        compatible = "zmk,matrix-transform";
        columns = <12>;
        rows = <4>;
// | SW1  | SW2  | SW3  | SW4  | SW5  | SW6  |                                   | SW6  | SW5  | SW4  | SW3  | SW2  | SW1  |
// | SW7  | SW8  | SW9  | SW10 | SW11 | SW12 |                                   | SW12 | SW11 | SW10 | SW9  | SW8  | SW7  |
// | SW13 | SW14 | SW15 | SW16 | SW17 | SW18 / SW19 /                     \ SW19 \ SW18 | SW17 | SW16 | SW15 | SW14 | SW13 |
//                         | SW20 / SW21 / SW22 / SW23 /               \ SW23 \ SW23 \ SW21 \ SW20 |
        map = <
RC(0,0) RC(0,1) RC(0,2) RC(0,3) RC(0,4) RC(0,5)                                   RC(0,6) RC(0,7) RC(0,8) RC(0,9) RC(0,10) RC(0,11)
RC(1,0) RC(1,1) RC(1,2) RC(1,3) RC(1,4) RC(1,5)                                   RC(1,6) RC(1,7) RC(1,8) RC(1,9) RC(1,10) RC(1,11)
RC(2,0) RC(2,1) RC(2,2) RC(2,3) RC(2,4) RC(2,5) RC(3,5)                   RC(3,6) RC(2,6) RC(2,7) RC(2,8) RC(2,9) RC(2,10) RC(2,11)
                                RC(3,1) RC(3,2) RC(3,3) RC(3,4)   RC(3,7) RC(3,8) RC(3,9) RC(3,10)
        >;
    };

    /* physical_layout moved here so per-key nodes can be defined after the transform */
    physical_layout: physical_layout_0 {
        compatible = "zmk,physical-layout";
        display-name = "HSHS46";
        rows = <4>;
        columns = <12>;
        transform = <&default_transform>;

        /* Per-key phandle-only list for ZMK Studio.
         * Each key is provided as a child node (key@N) below with a simple label.
         * The `keys` list references those child nodes by phandle so no phandle+index
         * format is used. This provides clearer labels inside ZMK Studio.
         */
        keys = <
            &key0  &key1  &key2  &key3  &key4  &key5  &key6  &key7  &key8  &key9  &key10 &key11
            &key12 &key13 &key14 &key15 &key16 &key17 &key18 &key19 &key20 &key21 &key22 &key23
            &key24 &key25 &key26 &key27 &key28 &key29 &key30 &key31 &key32 &key33 &key34 &key35
            &key36 &key37 &key38 &key39 &key40 &key41 &key42 &key43 &key44 &key45 &key46 &key47
        >;

        /* Per-key nodes (labels derived from the default QWERTY layer) */
        key0: key@0  { label = "GRAVE"; };
        key1: key@1  { label = "Q"; };
        key2: key@2  { label = "W"; };
        key3: key@3  { label = "E"; };
        key4: key@4  { label = "R"; };
        key5: key@5  { label = "T"; };
        key6: key@6  { label = "Y"; };
        key7: key@7  { label = "U"; };
        key8: key@8  { label = "I"; };
        key9: key@9  { label = "O"; };
        key10: key@10 { label = "P"; };
        key11: key@11 { label = "BSPC"; };

        key12: key@12 { label = "TAB"; };
        key13: key@13 { label = "A"; };
        key14: key@14 { label = "S"; };
        key15: key@15 { label = "D"; };
        key16: key@16 { label = "F"; };
        key17: key@17 { label = "G"; };
        key18: key@18 { label = "H"; };
        key19: key@19 { label = "J"; };
        key20: key@20 { label = "K"; };
        key21: key@21 { label = "L"; };
        key22: key@22 { label = "SEMI"; };
        key23: key@23 { label = "ENTER"; };

        key24: key@24 { label = "LCTRL"; };
        key25: key@25 { label = "Z"; };
        key26: key@26 { label = "X"; };
        key27: key@27 { label = "C"; };
        key28: key@28 { label = "V"; };
        key29: key@29 { label = "B"; };
        key30: key@30 { label = "ESC"; };
        key31: key@31 { label = "CAPS_WORD"; };
        key32: key@32 { label = "N"; };
        key33: key@33 { label = "M"; };
        key34: key@34 { label = "COMMA"; };
        key35: key@35 { label = "DOT"; };

        key36: key@36 { label = "LGUI"; };
        key37: key@37 { label = "LALT"; };
        key38: key@38 { label = "SK_LSHIFT"; };
        key39: key@39 { label = "MO_NAV_L"; };
        key40: key@40 { label = "MO_SYM_L"; };
        key41: key@41 { label = "SPACE"; };
        key42: key@42 { label = "LALT_2"; };
        key43: key@43 { label = "RGUI"; };
        key44: key@44 { label = "SLASH"; };
        key45: key@45 { label = "SQT"; };
        key46: key@46 { label = "RESERVED"; };
        key47: key@47 { label = "RESERVED"; };
    };

    kscan0: kscan {
        compatible = "zmk,kscan-gpio-matrix";
        label = "KSCAN";

        diode-direction = "col2row";
        row-gpios
            = <&pro_micro 5 (GPIO_ACTIVE_HIGH | GPIO_PULL_DOWN)>
            , <&pro_micro 6 (GPIO_ACTIVE_HIGH | GPIO_PULL_DOWN)>
            , <&pro_micro 7 (GPIO_ACTIVE_HIGH | GPIO_PULL_DOWN)>
            , <&pro_micro 9 (GPIO_ACTIVE_HIGH | GPIO_PULL_DOWN)>
            ;

    };


};
