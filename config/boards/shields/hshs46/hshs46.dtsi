/*
 * Copyright (c) 2021-2022 The ZMK Contributors
 *
 * SPDX-License-Identifier: MIT
 */

#include <dt-bindings/zmk/matrix_transform.h>

/ {
    chosen {
        zmk,kscan = &kscan0;
    };

    default_transform: keymap_transform_0 {
        compatible = "zmk,matrix-transform";
        columns = <12>;
        rows = <4>;
        #key-cells = <1>;
// | SW1  | SW2  | SW3  | SW4  | SW5  | SW6  |                                   | SW6  | SW5  | SW4  | SW3  | SW2  | SW1  |
// | SW7  | SW8  | SW9  | SW10 | SW11 | SW12 |                                   | SW12 | SW11 | SW10 | SW9  | SW8  | SW7  |
// | SW13 | SW14 | SW15 | SW16 | SW17 | SW18 / SW19 /                     \ SW19 \ SW18 | SW17 | SW16 | SW15 | SW14 | SW13 |
//                         | SW20 / SW21 / SW22 / SW23 /               \ SW23 \ SW23 \ SW21 \ SW20 |
        map = <
RC(0,0) RC(0,1) RC(0,2) RC(0,3) RC(0,4) RC(0,5)                                   RC(0,6) RC(0,7) RC(0,8) RC(0,9) RC(0,10) RC(0,11)
RC(1,0) RC(1,1) RC(1,2) RC(1,3) RC(1,4) RC(1,5)                                   RC(1,6) RC(1,7) RC(1,8) RC(1,9) RC(1,10) RC(1,11)
RC(2,0) RC(2,1) RC(2,2) RC(2,3) RC(2,4) RC(2,5) RC(3,5)                   RC(3,6) RC(2,6) RC(2,7) RC(2,8) RC(2,9) RC(2,10) RC(2,11)
                                RC(3,1) RC(3,2) RC(3,3) RC(3,4)   RC(3,7) RC(3,8) RC(3,9) RC(3,10)
        >;
    };

    /* physical_layout moved here so &default_transform phandle resolves */
    physical_layout: physical_layout_0 {
        compatible = "zmk,physical-layout";
        display-name = "HSHS46";
        rows = <4>;
        columns = <12>;
        transform = <&default_transform>;

        /* Index -> QWERTY label (default_layer) mapping (row-major, rows 0..3, cols 0..11)
         *
         * Row 0 (indices 0..11):
         *   0: GRAVE    1: Q      2: W      3: E      4: R      5: T
         *   6: Y        7: U      8: I      9: O     10: P     11: BSPC
         *
         * Row 1 (indices 12..23):
         *  12: TAB     13: A     14: S     15: D     16: F     17: G
         *  18: H      19: J     20: K     21: L     22: SEMI  23: ENTER
         *
         * Row 2 (indices 24..35):
         *  24: LCTRL  25: Z     26: X     27: C     28: V     29: B
         *  30: ESC   31: CAPS_WORD 32: N   33: M    34: COMMA 35: DOT
         *
         * Row 3 (indices 36..47) - thumb / lower row (approximate mapping):
         *  36: LGUI   37: LALT  38: SK_LSHIFT 39: MO_NAV_L 40: MO_SYM_L 41: SPACE
         *  42: LALT   43: RGUI  44: SLASH* 45: SQT* 46: (reserved) 47: (reserved)
         *
         * Notes:
         * - This comment block is intended as a human-readable mapping derived
         *   from the `default_layer` keymap in the keymap file. It is approximate
         *   for the lower rows because the keymap places some thumb keys across
         *   fewer physical columns; adjust these labels if you prefer a different
         *   labeling/ordering for ZMK Studio's UI.
         * - The actual `keys` property below uses phandle+index entries that
         *   reference the declared matrix transform. Do not change the phandle
         *   entries unless you understand the devicetree/phandle model.
         */

        /* keys must be a mix of phandles and numbers (phandle + index per key)
         * Use &default_transform followed by the key index (0..47) in row-major order.
         */
        keys = <
            &default_transform 0 &default_transform 1 &default_transform 2 &default_transform 3 &default_transform 4 &default_transform 5 &default_transform 6 &default_transform 7 &default_transform 8 &default_transform 9 &default_transform 10 &default_transform 11
            &default_transform 12 &default_transform 13 &default_transform 14 &default_transform 15 &default_transform 16 &default_transform 17 &default_transform 18 &default_transform 19 &default_transform 20 &default_transform 21 &default_transform 22 &default_transform 23
            &default_transform 24 &default_transform 25 &default_transform 26 &default_transform 27 &default_transform 28 &default_transform 29 &default_transform 30 &default_transform 31 &default_transform 32 &default_transform 33 &default_transform 34 &default_transform 35
            &default_transform 36 &default_transform 37 &default_transform 38 &default_transform 39 &default_transform 40 &default_transform 41 &default_transform 42 &default_transform 43 &default_transform 44 &default_transform 45 &default_transform 46 &default_transform 47
        >;
    };

    kscan0: kscan {
        compatible = "zmk,kscan-gpio-matrix";
        label = "KSCAN";

        diode-direction = "col2row";
        row-gpios
            = <&pro_micro 5 (GPIO_ACTIVE_HIGH | GPIO_PULL_DOWN)>
            , <&pro_micro 6 (GPIO_ACTIVE_HIGH | GPIO_PULL_DOWN)>
            , <&pro_micro 7 (GPIO_ACTIVE_HIGH | GPIO_PULL_DOWN)>
            , <&pro_micro 9 (GPIO_ACTIVE_HIGH | GPIO_PULL_DOWN)>
            ;

    };


};
